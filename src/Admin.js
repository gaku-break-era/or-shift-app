// src/Admin.js - Â§úÂã§/ÂΩìÁõ¥‰∫∫Êï∞„Ç´„Ç¶„É≥„ÉàÔºÜ‰øùÂ≠òÂæåÂç≥ÂèçÊò†Áâà
import React, { useEffect, useState } from "react";
import { getAuth, onAuthStateChanged } from "firebase/auth";
import { db } from "./firebase";
import { collection, getDocs, setDoc, doc, getDoc } from "firebase/firestore";
import { saveAs } from "file-saver";
import emailjs from "@emailjs/browser";
import { isWeekend } from "date-fns";
import dayjs from "dayjs";
import isSameOrBefore from "dayjs/plugin/isSameOrBefore";
import isSameOrAfter from "dayjs/plugin/isSameOrAfter";
import FeedbackForm from "./FeedbackForm";
import Header from "./components/ui/Header";
import { 
  calculateRequiredStaff, 
  applyHopes, 
  fillShifts, 
  assignBalancedNightShifts,
  assignNightShifts,
  assignComplexShifts 
} from "./utils/shiftAutoAssign";
import { writeBatch } from "firebase/firestore"; // ‚Üê „Åì„ÇåËøΩÂä†ÔºÅÔºÅ

dayjs.extend(isSameOrBefore);
dayjs.extend(isSameOrAfter);

const today = dayjs();
const defaultMonth = today.date() <= 10
  ? today.add(1, "month").month() + 1
  : today.add(2, "month").month() + 1;

const thStyle = { border: "1px solid #ccc", padding: "4px", background: "#fafafa" };
const tdStyle = { 
  border: "1px solid #ccc", 
  padding: "4px", 
  minHeight: "80px", 
  minWidth: "100px",
  fontSize: "0.8rem",
};


function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function Admin() {
  const [events, setEvents] = useState({});
  const [uniqueEmployeeIds, setUniqueEmployeeIds] = useState([]);
  const [dates, setDates] = useState([]);
  const [shiftMatrix, setShiftMatrix] = useState({});
  const [hopes, setHopes] = useState({});
  const [currentUser, setCurrentUser] = useState(null);
  const [staffList, setStaffList] = useState([]);
  const [unsubmitted, setUnsubmitted] = useState([]);
  const [showFeedback, setShowFeedback] = useState(false);
  const [loading, setLoading] = useState(true);
  const [submittedStaffIds, setSubmittedStaffIds] = useState(new Set());
  const [nightDutyCount, setNightDutyCount] = useState({});
  const [onCallDutyCount, setOnCallDutyCount] = useState({});
  const [dayShiftCount, setDayShiftCount] = useState({});
const [nightShiftCount, setNightShiftCount] = useState({});
const [lateCShiftCount, setLateCShiftCount] = useState({});
const [onCallShiftCount, setOnCallShiftCount] = useState({});
const [freeShiftCount, setFreeShiftCount] = useState({});


  const [currentMonth, setCurrentMonth] = useState(defaultMonth);
  const [skillData, setSkillData] = useState({});


  const EMAIL_SERVICE_ID = "service_12m5w0v";
  const EMAIL_TEMPLATE_ID = "template_gmkbnq8";
  const EMAIL_PUBLIC_KEY = "fmk7EZo2SxwG00Z7U";

  const shiftOptions = ["", "‚óØ", "/", "X]", "‰ºë", "Y", "<", "‚ñ°", "TF", "ÔΩµC", "ÔΩµÔæõ"];

  useEffect(() => {
    const auth = getAuth();
    const unsubscribe = onAuthStateChanged(auth, (user) => setCurrentUser(user));
    return () => unsubscribe();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const year = dayjs().year();
      const startOfMonth = dayjs(`${year}-${String(currentMonth).padStart(2, "0")}-01`);
      const endOfMonth = startOfMonth.endOf("month");
      const monthDates = [];
      let currentDate = startOfMonth;
      while (currentDate.isSameOrBefore(endOfMonth)) {
        monthDates.push(currentDate.format("YYYY-MM-DD"));
        currentDate = currentDate.add(1, "day");
      }
      setDates(monthDates);

      const staffSnap = await getDocs(collection(db, "staffList"));
const rawStaffData = staffSnap.docs.map((d) => ({
  id: d.id,
  employeeId: d.data().employeeId,
  lastName: d.data().lastName,
  firstName: d.data().firstName,
  email: d.data().email || "",
  year: d.data().year || "9999", // ‚Üê Âøµ„ÅÆ„Åü„ÇÅyear„ÇÇÂèñ„Çã
}));

// üî•„Åì„Åì„Åß rawStaffData „Çí yearÊòáÈ†Ü„Å´„ÇΩ„Éº„ÉàÔºÅ
const sortedStaffData = rawStaffData.sort((a, b) => {
  return Number(a.year) - Number(b.year);
});

setStaffList(sortedStaffData);
      

      const registeredEmployeeIds = sortedStaffData.map((s) => s.employeeId);
      setUniqueEmployeeIds(registeredEmployeeIds);

      const reqSnap = await getDocs(collection(db, "shiftRequests"));
      const hopeMap = {};
      const matrix = {};

      registeredEmployeeIds.forEach((empId) => {
        monthDates.forEach((date) => {
          matrix[`${empId}_${date}`] = "";
        });
      });

      const submittedIds = new Set();
      for (const docSnap of reqSnap.docs) {
        const req = docSnap.data();
        const empId = req.employeeId;
        if (!empId) continue;
        submittedIds.add(empId);

        const shifts = req.shifts || [];
        for (const shift of shifts) {
          const shiftDate = typeof shift.date === "string"
            ? shift.date
            : dayjs(shift.date).format("YYYY-MM-DD");
          const month = parseInt(shiftDate.slice(5, 7));
          if (month === currentMonth) {
            const key = `${empId}_${shiftDate}`;
            hopeMap[key] = shift.selection || "";
          }
        }
      }

      setSubmittedStaffIds(submittedIds);
      setUnsubmitted(registeredEmployeeIds.filter(id => !submittedIds.has(id)));
      setHopes(hopeMap);

      const title = `${year}Âπ¥${currentMonth}Êúà`;
      const savedSnap = await getDoc(doc(db, "shiftSchedules", title));
      if (savedSnap.exists()) {
        const saved = savedSnap.data();
        Object.keys(saved).forEach(empId => {
          Object.keys(saved[empId]).forEach(date => {
            if (monthDates.includes(date)) {
              matrix[`${empId}_${date}`] = saved[empId][date] || "";
            }
          });
        });
      }
      setShiftMatrix(matrix);

      // „Åì„Åì„ÅßÂ§úÂã§/ÂΩìÁõ¥‰∫∫Êï∞„Ç´„Ç¶„É≥„Éà„ÇÇÂÜçË®àÁÆó
      const nightCount = {};
      const onCallDutyCount = {};
      const dayCount = {};
      const lateCCount = {};
      const oncallShift = {};
      const freeCount = {};

      monthDates.forEach(date => {
        let day = 0, night = 0, oncall = 0, latec = 0, oncallsh = 0, free = 0;
        registeredEmployeeIds.forEach(empId => {
          const value = matrix[`${empId}_${date}`];
          if (value === "‚óØ" || value === "") day++;
          if (value === "/") night++;
          if (value === "‚ñ°") oncall++;
          if (value === "ÔΩµC") latec++;
          if (value === "ÔΩµÔæõ") oncallsh++;
          if (value === "TF") free++;
        });
        dayCount[date] = day;
        nightCount[date] = night;
        onCallDutyCount[date] = oncall;
        lateCCount[date] = latec;
        oncallShift[date] = oncallsh;
        freeCount[date] = free;
      });
      
      setDayShiftCount(dayCount);
      setNightShiftCount(nightCount);
      setOnCallDutyCount(onCallDutyCount);
      setLateCShiftCount(lateCCount);
      setOnCallShiftCount(oncallShift);
      setFreeShiftCount(freeCount);

    } catch (err) {
      console.error("Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:", err);
      alert("„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " + err.message);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, [currentMonth]);

  useEffect(() => {
    const fetchSkills = async () => {
      const skillsSnap = await getDocs(collection(db, "staffSkillSummary")); // ‰ªÆÊÉ≥„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥
      const skillMap = {};
      skillsSnap.docs.forEach(doc => {
        skillMap[doc.id] = doc.data();
      });
      setSkillData(skillMap);
    };
    fetchSkills();
  }, []);
  

  const [saving, setSaving] = useState(false); // üî• ËøΩÂä†ÔºÅ

 // È´òÂ∫¶„Å´ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Ç∑„Éï„Éà‰øùÂ≠òÈñ¢Êï∞
// Admin.js„Å´ÁµÑ„ÅøËæº„Çì„Åß‰ΩøÁî®

const handleSave = async () => {
  setSaving(true);
  try {
    console.log("‚úÖ „Ç∑„Éï„Éà‰øùÂ≠òÈñãÂßã");
    const dataToSave = {};
    const year = dayjs().year();
    const monthTitle = `${year}Âπ¥${currentMonth}Êúà`;
    
    // Êñ∞„Åó„ÅÑ‰øùÂ≠òÂΩ¢Âºè: ‚óØ„Å®Á©∫ÁôΩ„ÅØ‰øùÂ≠ò„Åó„Å™„ÅÑ
    uniqueEmployeeIds.forEach((empId) => {
      dataToSave[empId] = {};
      dates.forEach((date) => {
        const key = `${empId}_${date}`;
        const type = shiftMatrix[key] || "";
        if (type && type !== "‚óØ") {
          dataToSave[empId][date] = type;
        }
      });
      // ÂÖ®Êó•‚óØ„Å†„Å£„Åü„Çâ„ÄÅ„Åù„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§ÔºàFirestore„Å´ÁÑ°ÈßÑ„Éá„Éº„ÇøÊÆã„Åï„Å™„ÅÑÔºâ
      if (Object.keys(dataToSave[empId]).length === 0) {
        delete dataToSave[empId];
      }
    });

    // shiftSchedules‰øùÂ≠ò
    await setDoc(doc(db, "shiftSchedules", monthTitle), dataToSave);

    // ÂÄãÂà• shifts „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇÇ‰øùÂ≠ò
    const batch = writeBatch(db);
    uniqueEmployeeIds.forEach((empId) => {
      dates.forEach((date) => {
        const key = `${empId}_${date}`;
        const type = shiftMatrix[key] || "";
        const shiftRef = doc(db, "shifts", `${empId}_${date}`);

        if (type && type !== "‚óØ") {
          batch.set(shiftRef, {
            staffId: empId,
            date,
            type,
            updatedAt: dayjs().toISOString(),
          });
        } else {
          batch.delete(shiftRef);
        }
      });
    });
    await batch.commit();

    alert("‚úÖ ‰øùÂ≠òÂÆå‰∫ÜÔºÅÔºàË∂ÖËªΩÈáèÁâàÔºâ");
    fetchData(); // ‰øùÂ≠òÂæå„Å´ÂÜçË™≠Ëæº
  } catch (err) {
    console.error("‚ùå ‰øùÂ≠ò„Ç®„É©„Éº:", err);
    alert("‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " + err.message);
  } finally {
    setSaving(false);
  }
};


// ‰ª•‰∏ã„ÅØÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Å´ÁΩÆ„ÅçÊèõ„Åà„Åö„Å´„ÄÅËøΩÂä†„ÅßÂÆüË£Ö„Åô„Çã„Å®ËâØ„ÅÑË£úÂä©Èñ¢Êï∞

// ÂæÖÊ©üÈñ¢Êï∞ (async/await „Åß‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´Promise„Åß„É©„ÉÉ„Éó)
const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// ÊåáÊï∞„Éê„ÉÉ„ÇØ„Ç™„Éï„Å§„ÅçÂÜçË©¶Ë°å
const retryWithBackoff = async (fn, maxRetries = 3, initialDelayMs = 1000) => {
  let retries = 0;
  
  while (true) {
    try {
      return await fn();
    } catch (error) {
      retries++;
      
      if (retries > maxRetries) {
        throw error;
      }
      
      const delayMs = initialDelayMs * Math.pow(2, retries - 1);
      await sleep(delayMs);
    }
  }
};

  
  
  
  
  

const handleAutoAssign = async () => {
  const initializedMatrix = {};
  uniqueEmployeeIds.forEach((empId) => {
    dates.forEach((date) => {
      initializedMatrix[`${empId}_${date}`] = "";
    });
  });

  let updatedMatrix = applyHopes(initializedMatrix, uniqueEmployeeIds, dates, hopes);
  updatedMatrix = await assignComplexShifts(updatedMatrix, uniqueEmployeeIds, dates, skillData, calculateRequiredStaff(dates));
  updatedMatrix = fillShifts(updatedMatrix, uniqueEmployeeIds, dates, calculateRequiredStaff(dates));

  setShiftMatrix(updatedMatrix);
  alert("ü§ñ AI„Ç∑„Éï„ÉàÂâ≤„ÇäÂΩì„Å¶ÂÆå‰∫ÜÔºÅ");
};


  
  
  
  
    
  
  const handleCSVDownload = () => {
    let csv = ["Á§æÂì°Áï™Âè∑", "Ê∞èÂêç", ...dates].join(",") + "\n";
    uniqueEmployeeIds.forEach((empId) => {
      const staff = staffList.find(s => s.employeeId === empId);
      const name = staff ? `${staff.lastName} ${staff.firstName}` : empId;
      const row = [empId, name];
      dates.forEach((date) => {
        row.push(shiftMatrix[`${empId}_${date}`] || "");
      });
      csv += row.join(",") + "\n";
    });
    saveAs(new Blob([csv], { type: "text/csv" }), `${dayjs().year()}-${currentMonth}_shift.csv`);
  };

  const handleSendReminders = async () => {
    const results = [];
    for (const empId of unsubmitted) {
      const staff = staffList.find((s) => s.employeeId === empId);
      const email = staff?.email;
      if (!email) {
        results.push(`${empId}Ôºö„É°„Éº„É´„Ç¢„Éâ„É¨„ÇπÊú™ÁôªÈå≤`);
        continue;
      }
      try {
        await emailjs.send(
          EMAIL_SERVICE_ID,
          EMAIL_TEMPLATE_ID,
          { name: `${staff.lastName} ${staff.firstName}`, to_email: email },
          EMAIL_PUBLIC_KEY
        );
        results.push(`${empId}ÔºöÈÄÅ‰ø°ÊàêÂäü`);
      } catch (err) {
        console.error(`${empId}„Å∏„ÅÆ„É°„Éº„É´ÈÄÅ‰ø°„Ç®„É©„Éº:`, err);
        results.push(`${empId}ÔºöÈÄÅ‰ø°Â§±Êïó`);
      }
    }
    alert("ÂÇ¨‰øÉÁµêÊûúÔºö\n" + results.join("\n"));
  };
  

  const handleChange = (empId, date, value) => {
    setShiftMatrix((prev) => ({
      ...prev,
      [`${empId}_${date}`]: value,
    }));
  };

  const getDisplayName = (empId) => {
    const staff = staffList.find((s) => s.employeeId === empId);
    return staff ? `${staff.lastName} ${staff.firstName}` : empId;
  };

  const getHopeLabel = (key) => {
    if (hopes[key] === "off") return "‰ºë„ÅøÂ∏åÊúõ";
    if (hopes[key] === "night") return "Â§úÂã§Â∏åÊúõ";
    if (hopes[key] === "none") return "Â∏åÊúõ„Å™„Åó";
    return "";
  };

  const getEventLabel = (key) => (events[key] ? `üîî${events[key]}` : "");

  if (!currentUser) return <p>„É≠„Ç∞„Ç§„É≥‰∏≠...</p>;

  if (loading) return (
    <div style={{ padding: "1rem", fontFamily: "sans-serif", textAlign: "center" }}>
      <Header />
      <h2>„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</h2>
    </div>
  );

  return (
    <div style={{ padding: "1rem", overflowX: "auto", fontFamily: "sans-serif" }}>
      <Header />
      <div style={{ padding: "1rem" }}>
        <h1>{`${dayjs().year()}Âπ¥${currentMonth}Êúà„ÅÆ„Ç∑„Éï„Éà‰ΩúÊàêÁîªÈù¢`}</h1>

        {/* ÊúàÂàá„ÇäÊõø„Åà */}
        <div style={{ margin: "0.5rem 0" }}>
          <button onClick={() => setCurrentMonth((p) => (p === 1 ? 12 : p - 1))}>‚óÄ ÂâçÊúà</button>
          <span style={{ margin: "0 1rem" }}>{`${currentMonth}Êúà`}</span>
          <button onClick={() => setCurrentMonth((p) => (p === 12 ? 1 : p + 1))}>ÁøåÊúà ‚ñ∂</button>
        </div>

        {/* ‰øùÂ≠ò„Éú„Çø„É≥ */}
        {/* Êìç‰Ωú„Éú„Çø„É≥Âàó */}
<div style={{ 
  display: "flex",
  flexWrap: "wrap",
  gap: "1rem",
  margin: "1rem 0"
}}>
  <button
  onClick={handleSave}
  disabled={saving} // ‰øùÂ≠ò‰∏≠„ÅØÊäº„Åõ„Å™„ÅÑÔºÅ
  style={{
    flex: "1 1 calc(50% - 1rem)",
    padding: "1rem",
    backgroundColor: saving ? "#bbb" : "#4285F4",
    color: "white",
    border: "none",
    borderRadius: "8px",
    fontSize: "1rem",
    cursor: saving ? "not-allowed" : "pointer",
  }}
>
  {saving ? "‰øùÂ≠ò‰∏≠..." : "üíæ „Ç∑„Éï„Éà„Çí‰øùÂ≠ò"}
</button>


  <button
    onClick={handleAutoAssign}
    style={{
      flex: "1 1 calc(50% - 1rem)",
      padding: "1rem",
      backgroundColor: "#FBBC05",
      color: "#333",
      border: "none",
      borderRadius: "8px",
      fontSize: "1rem",
      cursor: "pointer",
    }}
  >
    ü§ñ AI‰ªÆÂâ≤„ÇäÂΩì„Å¶
  </button>

  <button
    onClick={handleCSVDownload}
    style={{
      flex: "1 1 calc(50% - 1rem)",
      padding: "1rem",
      backgroundColor: "#34A853",
      color: "white",
      border: "none",
      borderRadius: "8px",
      fontSize: "1rem",
      cursor: "pointer",
    }}
  >
    üìë CSVÂá∫Âäõ
  </button>

  <button
    onClick={handleSendReminders}
    style={{
      flex: "1 1 calc(50% - 1rem)",
      padding: "1rem",
      backgroundColor: "#EA4335",
      color: "white",
      border: "none",
      borderRadius: "8px",
      fontSize: "1rem",
      cursor: "pointer",
    }}
  >
    ‚úâÔ∏è Êú™ÊèêÂá∫ËÄÖÂÇ¨‰øÉ
  </button>
</div>


        

        {/* Âá°‰æã */}
        <div style={{ display: "flex", gap: "1rem", margin: "1rem 0", fontSize: "0.85rem", flexWrap: "wrap" }}>
          <div style={{ display: "flex", alignItems: "center" }}>
            <div style={{ width: "16px", height: "16px", backgroundColor: "#ffebee", marginRight: "4px", border: "1px solid #ccc" }}></div>
            <span>Â∏åÊúõÊú™ÊèêÂá∫„Çπ„Çø„ÉÉ„Éï</span>
          </div>
          <div style={{ display: "flex", alignItems: "center" }}>
            <div style={{ width: "16px", height: "16px", backgroundColor: "#e0f7fa", marginRight: "4px", border: "1px solid #ccc" }}></div>
            <span>‰ºë„ÅøÂ∏åÊúõ</span>
          </div>
          <div style={{ display: "flex", alignItems: "center" }}>
            <div style={{ width: "16px", height: "16px", backgroundColor: "#fce4ec", marginRight: "4px", border: "1px solid #ccc" }}></div>
            <span>Â§úÂã§Â∏åÊúõ</span>
          </div>
          <div style={{ display: "flex", alignItems: "center" }}>
            <div style={{ width: "16px", height: "16px", backgroundColor: "#f9f9f9", marginRight: "4px", border: "1px solid #ccc" }}></div>
            <span>Â∏åÊúõ„Å™„Åó</span>
          </div>
        </div>

        

        {/* „Ç∑„Éï„ÉàË°® */}
        <div style={{ overflowX: "auto", width: "100%", border: "1px solid #ccc" }}>
        <table style={{ borderCollapse: "collapse", minWidth: "1200px", tableLayout: "fixed" }}>

        <thead>
          <tr>
            <th style={{
              ...thStyle,
              position: "sticky",
              top: 0,
              backgroundColor: "#fff",
              zIndex: 2,
            }}>
              ÂêçÂâç
            </th>
            {dates.map((date) => (
              <th key={date} style={{
                ...thStyle,
                position: "sticky",
                top: 0,
                backgroundColor: "#fff",
                zIndex: 2,
              }}>
                {dayjs(date).date()}({["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][dayjs(date).day()]})
              </th>
            ))}
          </tr>
        </thead>


          <tbody>
            {uniqueEmployeeIds.map((empId) => {
              const hasSubmitted = submittedStaffIds.has(empId);
              return (
                <tr key={empId}>
                  <td style={{
                  ...tdStyle,
                  backgroundColor: hasSubmitted ? "white" : "#ffebee",
                  position: "sticky",
                  left: 0,
                  zIndex: 1,
                  minWidth: "140px",
                  fontWeight: "bold",
                }}>
                  {getDisplayName(empId)}
                </td>

                  {dates.map((date) => {
                    const key = `${empId}_${date}`;
                    const hopeValue = hopes[key];
                    const bg =
                      !hasSubmitted ? "#fff8e1" :
                      hopeValue === "off" ? "#e0f7fa" :
                      hopeValue === "night" ? "#fce4ec" :
                      hopeValue === "none" ? "#f9f9f9" : "white";
                    return (
                      <td key={key} style={{ ...tdStyle, backgroundColor: bg }}>
                        <div style={{ fontSize: "0.7rem", color: "#666" }}>
                          {!hasSubmitted ? "Â∏åÊúõÊú™ÊèêÂá∫" : getHopeLabel(key)}
                          {getEventLabel(key)}
                        </div>
                        <select
                          value={shiftMatrix[key] || ""}
                          onChange={(e) => handleChange(empId, date, e.target.value)}
                          style={{ width: "50px", marginTop: "2px" }}
                        >
                          {shiftOptions.map((opt) => (
                            <option key={opt} value={opt}>
                              {opt === "" ? "‚óØ" : opt}  {/* „Åì„ÅìÔºÅÔºÅÁ©∫ÁôΩ„Å™„Çâ„Äå‚óØ„ÄçË°®Á§∫ */}
                            </option>
                          ))}
                        </select>
                      </td>
                    );
                  })}
                </tr>
              );
            })}
            {/* ‚ñº‚ñº‚ñº ‰∫∫Êï∞„Ç´„Ç¶„É≥„ÉàË°å ‚ñº‚ñº‚ñº */}
<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#e0f7fa" }}>
    Êó•
  </td>
  {dates.map((date) => (
    <td key={`day_${date}`} style={{ ...tdStyle, backgroundColor: "#e0f7fa", textAlign: "center", fontWeight: "bold" }}>
      {dayShiftCount[date] || 0}
    </td>
  ))}
</tr>

<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#fce4ec" }}>
    Â§ú
  </td>
  {dates.map((date) => (
    <td key={`night_${date}`} style={{ ...tdStyle, backgroundColor: "#fce4ec", textAlign: "center", fontWeight: "bold" }}>
      {nightShiftCount[date] || 0}
    </td>
  ))}
</tr>

<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#fce4ec" }}>
    ÂΩì
  </td>
  {dates.map((date) => (
    <td key={`oncall_${date}`} style={{ ...tdStyle, backgroundColor: "#fce4ec", textAlign: "center", fontWeight: "bold" }}>
      {onCallDutyCount[date] || 0}
    </td>
  ))}
</tr>

<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#e8f5e9" }}>
    ÈÅÖC
  </td>
  {dates.map((date) => (
    <td key={`latec_${date}`} style={{ ...tdStyle, backgroundColor: "#e8f5e9", textAlign: "center", fontWeight: "bold" }}>
      {lateCShiftCount[date] || 0}
    </td>
  ))}
</tr>

<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#fff3e0" }}>
    ÔΩµÔæõ
  </td>
  {dates.map((date) => (
    <td key={`oncallsh_${date}`} style={{ ...tdStyle, backgroundColor: "#fff3e0", textAlign: "center", fontWeight: "bold" }}>
      {onCallShiftCount[date] || 0}
    </td>
  ))}
</tr>

<tr>
  <td style={{ ...tdStyle, fontWeight: "bold", backgroundColor: "#ede7f6" }}>
    F
  </td>
  {dates.map((date) => (
    <td key={`free_${date}`} style={{ ...tdStyle, backgroundColor: "#ede7f6", textAlign: "center", fontWeight: "bold" }}>
      {freeShiftCount[date] || 0}
    </td>
  ))}
</tr>

          </tbody>
        </table>
        </div>

        {/* ÊîπÂñÑÊèêÊ°à */}
        {showFeedback
          ? <FeedbackForm onClose={() => setShowFeedback(false)} />
          : <button onClick={() => setShowFeedback(true)} style={{ marginTop: "1rem" }}>
              ÊîπÂñÑÊèêÊ°à„ÇíÈÄÅ„Çã
            </button>
        }
      </div>
    </div>
  );
}

export default Admin;
